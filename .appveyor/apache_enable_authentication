#!/bin/bash

set -e -u

user=$1; shift
password=$1; shift

sudo htpasswd -bc /var/www/passwords "$user" "$password"

cat > /tmp/htaccess <<EOF
AuthType Basic
AuthName "Restricted study data"
AuthBasicProvider file
AuthUserFile "/var/www/passwords"
Require user test.user
EOF

while [ "$1" ]; do
  sudo cp /tmp/htaccess "$DATA_DIR"/"$1"/.htaccess
  shift
done

rm -f /tmp/htaccess
