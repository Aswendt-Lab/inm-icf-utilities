# This setup tests ICF-related software and workflows. There are two elements
# that have to be kept aligned with ICF's environment:
#
# 1. The input data structure should match the data that ICF receives from
#    acquisition sides.
#
# 2. The software environment should match the environment on ICF's machines,
#    i.e. the versions of: `git`, `git-annex`, `python`, `datalad`, and
#    `datalad-next`.


# This version of Ubuntu is based on debian bullseye
image: Ubuntu


environment:
  # Those are currently used to engineer the test VM. They will be removed,
  # once the test VM is complete.
  APPVEYOR_SSH_KEY: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC0ou94Vnrz7iClYApJWv9FVOjT8uDgaF4Uf6wRW2VzLWD4/YwtxD5tsri9SfyQXFwVs94H0EAZSUz06VSM7uQwtOyeoHhERCfx0u+GC1UaFPLi20+4x7GLwipKLRWaf6dHfO5R4LkgDxH9Lc2KbzD0JYB7Lt4Hk54TWd1RaLuM0JGJCJc/0z5uQsyf6iH3Rf2Rcueoa61ztyjBwHaTJT8NOOtBATJXupN5c7Ss63hM7NecMdsalkLCnKQ3CwXQ8Wyp6w3XKvTlymJaWZBxBlA8MzVv89z9oReYnbWDzfWvNn4JU9JDcyOxTec/hd58vRZ+Pz1ZFU6WipoJ0gb0GBu/
  APPVEYOR_SSH_BLOCK: true


install:
  # Install apache
  - sh: sudo apt-get update
  - sh: sudo apt-get -y install apache2
  - sh: .appveyor/apache_enable_user_dir

  # Create study directories
  - sh: sudo mkdir -p /var/www/data/study_1
  - sh: sudo mkdir -p /var/www/data/study_2

  # Create user http content and link two studies. The http server is configured
  # to follow only links if the owner of the link matches the owner of the
  # target. Therefore root has to create the links.
  - sh: mkdir ~/public_html
  - sh: sudo ln -s /var/www/data/study_1 /home/appveyor/public_html/study_1
  - sh: sudo ln -s /var/www/data/study_2 /home/appveyor/public_html/study_2

  # Enable basic authentication and authorization for the study directories. The
  # user name is ``test.user´´, the password is ``secret_1´´.
  - sh: .appveyor/apache_enable_authentication

  # Enable external SSH access to CI worker on all other systems. This needs
  # APPVEYOR_SSH_KEY defined in project settings (or environment)
  - sh: curl -sflL 'https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-ssh.sh' | bash -e -


# Disable automatic builds with MSBuild, we do not use it.
build: off
